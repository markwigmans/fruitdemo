version: "2"

services:
  config:
    image: demo/config
    ports:
      - "8888"
    volumes:
      - ./config-repo:/config

  nginx-frontend:
    image: nginx:latest
    volumes:
      - ./nginx-fe.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - frontend
    ports:
      - "9081:4000"

  frontend:
    image: demo/frontend
    depends_on:
      - config
    ports:
      - "8081"
    environment:
      CONFIG_HOST: config

  nginx-backend:
    image: nginx:latest
    volumes:
      - ./nginx-be.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - backend
    ports:
      - "9080:4000"

  backend:
    image: demo/backend
    depends_on:
      - config
      - oracle
    ports:
      - "8080"
    environment:
      CONFIG_HOST: config

#
# Oracle Database
#
  oracle:
    image: oracleinanutshell/oracle-xe-11g
    ports:
      - "1521:1521"
      - "5500:5500"

#
# MySQL Database
#
#  mysql:
#    image: mysql:5.7
#    ports:
#      - "3306:3306"
#    volumes:
#      - ./db_data:/var/lib/mysql
#    restart: always
#    environment:
#      MYSQL_ROOT_PASSWORD: root
#      MYSQL_DATABASE: demo
#      MYSQL_USER: demo
#      MYSQL_PASSWORD: demo